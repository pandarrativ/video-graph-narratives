{"ast":null,"code":"var _jsxFileName = \"/home/yhx/Projects/AnnVideo/Frontend/src/components/ImageCanvas.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from 'react';\nimport \"../assets/css/canvas.css\";\nimport { boxColors } from '../assets/utils/utils';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction ImageCanvas(props) {\n  _s();\n  const [boxes, setBoxes] = useState([]);\n  const [color, setColor] = useState(boxColors[0]);\n  const [canvas, setCanvas] = useState();\n  const [ctx, setCtx] = useState();\n  // const [canvasBox, setCanvasBox] = useState();\n  const [ctxBox, setCtxBox] = useState();\n  // calculate the x-y of the canvas\n  const [offsetX, setOffsetX] = useState();\n  const [offsetY, setOffsetY] = useState();\n  const canvasRef = useRef();\n  const canvasBoxRef = useRef();\n  useEffect(() => {\n    const imageCanvas = canvasRef.current;\n    setCanvas(imageCanvas);\n    setCtx(imageCanvas.getContext(\"2d\"));\n    setOffsetX(imageCanvas.getBoundingClientRect().left);\n    setOffsetY(imageCanvas.getBoundingClientRect().top);\n    setCtxBox(canvasBoxRef.current.getContext(\"2d\"));\n  }, []);\n\n  // Change box colors and ids\n  useEffect(() => {\n    let n = boxColors.length;\n    let colorIndex = boxes.length % n;\n    setColor(boxColors[colorIndex]);\n  }, [boxes]);\n\n  // clean all the \n\n  ///////////////////// for drawing one box ////////////////////////////\n  //  flag: where user is dragging the box\n  const [isDown, setIsDown] = useState(false);\n  const [startX, setStartX] = useState();\n  const [startY, setStartY] = useState();\n  const [prevStartX, setPrevStartX] = useState(0);\n  const [prevStartY, setPrevStartY] = useState(0);\n  const [prevWidth, setPrevWidth] = useState(0);\n  const [prevHeight, setPrevHeight] = useState(0);\n  const handleMouseUp = e => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    // the drag is over, clear the dragging flag\n    setIsDown(false);\n    ctxBox.strokeStyle = color;\n    ctxBox.strokeRect(prevStartX, prevStartY, prevWidth, prevHeight);\n    setBoxes([...boxes, {\n      \"id\": boxes.length,\n      'name': `<region ${boxes.length}>`,\n      'color': color,\n      \"box\": [prevStartX, prevStartY, prevWidth, prevHeight]\n    }]);\n  };\n  const handleMouseDown = e => {\n    e.preventDefault();\n    e.stopPropagation();\n    const rect = canvasRef.current.getBoundingClientRect();\n    const currentOffsetX = rect.left;\n    const currentOffsetY = rect.top;\n    ctx.strokeStyle = color;\n    setStartX(parseInt(e.clientX - currentOffsetX + window.scrollX));\n    setStartY(parseInt(e.clientY - currentOffsetY + window.scrollY));\n    setIsDown(true);\n  };\n  const handleMouseMove = e => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!isDown) {\n      return;\n    }\n    const rect = canvasRef.current.getBoundingClientRect();\n    const currentOffsetX = rect.left;\n    const currentOffsetY = rect.top;\n    let mouseX = parseInt(e.clientX - currentOffsetX + window.scrollX);\n    let mouseY = parseInt(e.clientY - currentOffsetY + window.scrollY);\n    var width = mouseX - startX;\n    var height = mouseY - startY;\n    ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    ctx.strokeRect(startX, startY, width, height);\n    setPrevStartX(startX);\n    setPrevStartY(startY);\n    setPrevWidth(width);\n    setPrevHeight(height);\n  };\n  const handleMouseOut = e => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    // the drag is over, clear the dragging flag\n    setIsDown(false);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"canvas-wrapper\",\n    children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n      id: \"canvaxBox\",\n      ref: canvasBoxRef,\n      height: 500,\n      width: 500\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      id: \"imageCanvas\",\n      height: 500,\n      width: 500,\n      ref: canvasRef,\n      onMouseDown: handleMouseDown,\n      onMouseUp: handleMouseUp,\n      onMouseMove: handleMouseMove,\n      onMouseOut: handleMouseOut\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 9\n  }, this);\n}\n_s(ImageCanvas, \"yZxqv52fg5VixLGtB8ahTeaYR4A=\");\n_c = ImageCanvas;\nexport default ImageCanvas;\nvar _c;\n$RefreshReg$(_c, \"ImageCanvas\");","map":{"version":3,"names":["React","useRef","useEffect","useState","boxColors","jsxDEV","_jsxDEV","ImageCanvas","props","_s","boxes","setBoxes","color","setColor","canvas","setCanvas","ctx","setCtx","ctxBox","setCtxBox","offsetX","setOffsetX","offsetY","setOffsetY","canvasRef","canvasBoxRef","imageCanvas","current","getContext","getBoundingClientRect","left","top","n","length","colorIndex","isDown","setIsDown","startX","setStartX","startY","setStartY","prevStartX","setPrevStartX","prevStartY","setPrevStartY","prevWidth","setPrevWidth","prevHeight","setPrevHeight","handleMouseUp","e","preventDefault","stopPropagation","strokeStyle","strokeRect","handleMouseDown","rect","currentOffsetX","currentOffsetY","parseInt","clientX","window","scrollX","clientY","scrollY","handleMouseMove","mouseX","mouseY","width","height","clearRect","handleMouseOut","id","children","ref","fileName","_jsxFileName","lineNumber","columnNumber","onMouseDown","onMouseUp","onMouseMove","onMouseOut","_c","$RefreshReg$"],"sources":["/home/yhx/Projects/AnnVideo/Frontend/src/components/ImageCanvas.js"],"sourcesContent":["import React,{useRef, useEffect, useState} from 'react';\nimport \"../assets/css/canvas.css\";\nimport { boxColors } from '../assets/utils/utils';\n\nfunction ImageCanvas(props) {\n    const [boxes, setBoxes] = useState([]);\n    const [color, setColor] = useState(boxColors[0]);\n\n    const [canvas, setCanvas] = useState();\n    const [ctx, setCtx] = useState();\n    // const [canvasBox, setCanvasBox] = useState();\n    const [ctxBox, setCtxBox] = useState();\n    // calculate the x-y of the canvas\n    const [offsetX, setOffsetX] = useState();\n    const [offsetY, setOffsetY] = useState();\n\n    const canvasRef = useRef();\n    const canvasBoxRef = useRef();\n    useEffect(() => {\n        const imageCanvas = canvasRef.current;\n        setCanvas(imageCanvas);\n        setCtx(imageCanvas.getContext(\"2d\"));\n        setOffsetX(imageCanvas.getBoundingClientRect().left);\n        setOffsetY(imageCanvas.getBoundingClientRect().top)\n        setCtxBox(canvasBoxRef.current.getContext(\"2d\"));\n    },[])\n\n    // Change box colors and ids\n    useEffect(() => {\n        let n = boxColors.length;\n        let colorIndex = boxes.length %n; \n        setColor(boxColors[colorIndex])\n    }, [boxes])\n\n    // clean all the \n\n\n\n\n    ///////////////////// for drawing one box ////////////////////////////\n    //  flag: where user is dragging the box\n    const [isDown, setIsDown] = useState(false);\n    const [startX, setStartX] = useState();\n    const [startY, setStartY] = useState();\n\n    const [prevStartX, setPrevStartX] = useState(0);\n    const [prevStartY, setPrevStartY] = useState(0);\n\n    const [prevWidth, setPrevWidth] = useState(0);\n    const [prevHeight, setPrevHeight] = useState(0);    \n\n\n\n    const handleMouseUp = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n    \n        // the drag is over, clear the dragging flag\n        setIsDown(false);\n        ctxBox.strokeStyle = color;\n        ctxBox.strokeRect(prevStartX, prevStartY, prevWidth, prevHeight);\n        setBoxes([...boxes, {\n            \"id\":boxes.length,\n            'name':`<region ${boxes.length}>`,\n            'color':color,\n            \"box\":[prevStartX, prevStartY, prevWidth, prevHeight]\n        }])\n    }\n\n    const handleMouseDown = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n    \n        const rect = canvasRef.current.getBoundingClientRect();\n        const currentOffsetX = rect.left;\n        const currentOffsetY = rect.top;\n        \n        ctx.strokeStyle=color;\n        setStartX(parseInt(e.clientX - currentOffsetX + window.scrollX));\n        setStartY(parseInt(e.clientY - currentOffsetY + window.scrollY));\n    \n        setIsDown(true);\n    };\n    \n    const handleMouseMove = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n    \n        if (!isDown) {\n            return;\n        }\n    \n        const rect = canvasRef.current.getBoundingClientRect();\n        const currentOffsetX = rect.left;\n        const currentOffsetY = rect.top;\n    \n        let mouseX = parseInt(e.clientX - currentOffsetX + window.scrollX);\n        let mouseY = parseInt(e.clientY - currentOffsetY + window.scrollY);\n    \n        var width = mouseX - startX;\n        var height = mouseY - startY;\n    \n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n        ctx.strokeRect(startX, startY, width, height);\n    \n        setPrevStartX(startX);\n        setPrevStartY(startY);\n        setPrevWidth(width);\n        setPrevHeight(height);\n    };\n\n    const handleMouseOut = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n    \n        // the drag is over, clear the dragging flag\n        setIsDown(false);\n    }\n\n\n    return (\n        <div id='canvas-wrapper'>\n            <canvas id=\"canvaxBox\" ref={canvasBoxRef} height={500} width={500}></canvas>\n            <canvas \n                id=\"imageCanvas\"\n                height={500} \n                width={500}\n                ref={canvasRef} \n                onMouseDown={handleMouseDown} \n                onMouseUp={handleMouseUp}\n                onMouseMove={handleMouseMove}\n                onMouseOut={handleMouseOut}\n            ></canvas>\n            \n        </div>\n\n    );\n}\n\nexport default ImageCanvas;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}